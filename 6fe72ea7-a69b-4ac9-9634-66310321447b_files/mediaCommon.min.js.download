"use strict";define("mediaCommon/mediaLogic/fillLogicMixin",["lodash","react","santaProps","utils","balata"],function(e,a,t,i,s){function p(a){return e.get(a.compDesign,["background","mediaRef"],e.get(a.compData,["background","mediaRef"]))||{}}var o=i.mediaConsts;return{propTypes:e.defaults({id:t.Types.Component.id.isRequired,styleId:t.Types.Component.styleId.isRequired,compProp:t.Types.Component.compProp,compData:t.Types.Component.compData,compDesign:t.Types.Component.compDesign,compStaticBehaviors:t.Types.Component.compStaticBehaviors,compDynamicBehaviors:t.Types.Component.compDynamicBehaviors,bgStyle:a.PropTypes.object,onClick:a.PropTypes.func,mediaAspect:t.Types.SiteAspects.mediaAspect.isRequired,mediaQuality:t.Types.Media.mediaQuality,isDesktopDevice:t.Types.Device.isDesktopDevice.isRequired,isMobileView:t.Types.isMobileView.isRequired,isPlayingAllowed:t.Types.RenderFlags.isPlayingAllowed.isRequired},t.santaTypesUtils.getSantaTypesByDefinition(s)),getInitialState:function(){return this.registerPlayer(this.props),this.mediaAPI=null,{}},componentWillReceiveProps:function(e){this.handleVideoDataChange(this.props,e)},handleAutoplay:function(e,a){var t=a===o.playbackTypes.READY,i=p(e).autoplay;t&&i&&e.isPlayingAllowed&&this.playMedia()},handleVideoDataChange:function(e,a){var t=p(a),i=p(e);t.videoId!==i.videoId?(this.unregisterPlayer(e),this.registerPlayer(a)):t.autoplay!==i.autoplay&&e.isPlayingAllowed&&(t.autoplay?this.playMedia():this.pauseMedia())},registerPlayer:function(a){var t=p(a);if("WixVideo"===e.get(t,"type")){var i={playerType:"mediaContainer",mediaData:t,services:{viewport:{callback:this.onViewportChange,eventTypes:["in","out"]},visibility:{callback:this.onVisibilityChange},fileAvailability:{callback:this.onFileAvailability,mediaQuality:a.mediaQuality}}};a.mediaAspect.registerPlayer(a.id,i)}},unregisterPlayer:function(e){e.mediaAspect.unregisterPlayer(e.id)},updatePlayerState:function(e,a){e.mediaAspect.updatePlayerState(e.id,a)},updateQualityState:function(e,a,t){e.mediaAspect.updateQualityState(a,t)},onMediaChange:function(e){var a=this.props.mediaAspect.getData(this.props.id)||{},t=this.mediaStateChangeLogic(e,a);e.type===o.eventTypes.LOAD&&this.handleAutoplay(this.props,t.playbackState),this.updatePlayerState(this.props,t)},mediaStateChangeLogic:function(e,a){var t={},i=a.playbackState===o.playbackTypes.PLAYING;switch(e.type){case o.eventTypes.MOUNT:t={playbackState:e.playbackState};break;case o.eventTypes.LOAD:t={playbackState:e.playbackState,volume:e.volume,fullscreen:!1,muted:e.muted,currentTime:e.currentTime,progress:e.progress};break;case o.eventTypes.PLAYSTATE:var s=a.playbackState===o.playbackTypes.SEEK_PLAYING||a.playbackState===o.playbackTypes.SEEK_PAUSED;e.playbackState===o.playbackTypes.SEEKING?s||(t={playbackState:i?o.playbackTypes.SEEK_PLAYING:o.playbackTypes.SEEK_PAUSED}):e.playbackState===o.playbackTypes.SEEKING_ENDED?t={playbackState:a.playbackState===o.playbackTypes.SEEK_PLAYING?o.playbackTypes.PLAYING:o.playbackTypes.PAUSED}:s||(t={playbackState:e.playbackState});break;case o.eventTypes.ERROR:break;case o.eventTypes.TIME_UPDATE:t={currentTime:e.currentTime};break;case o.eventTypes.PROGRESS:t={progress:e.progress};break;case o.eventTypes.VOLUME:t={volume:e.volume,muted:e.muted}}return e.duration&&(t.duration=e.duration),t},onViewportChange:function(e){if(this.props.isPlayingAllowed&&!e.isFixed){var a=this.props.mediaAspect.getData(this.props.id);e.in?a.previousPlaybackState===o.playbackTypes.PLAYING&&(this.updatePlayerState(this.props,{previousPlaybackState:""}),this.playMedia()):e.out&&(a.playbackState===o.playbackTypes.PLAYING?(this.updatePlayerState(this.props,{previousPlaybackState:o.playbackTypes.PLAYING}),this.pauseMedia()):a.previousPlaybackState||this.updatePlayerState(this.props,{previousPlaybackState:a.playbackState}))}},onVisibilityChange:function(e){if(this.props.isPlayingAllowed){var a=this.props.mediaAspect.getData(this.props.id);e.hidden?e.hidden&&(a.playbackState===o.playbackTypes.PLAYING?(this.updatePlayerState(this.props,{previousPlaybackState:o.playbackTypes.PLAYING}),this.pauseMedia()):a.previousPlaybackState||this.updatePlayerState(this.props,{previousPlaybackState:a.playbackState})):a.previousPlaybackState===o.playbackTypes.PLAYING&&(this.updatePlayerState(this.props,{previousPlaybackState:""}),this.playMedia())}},onFileAvailability:function(e){this.updateQualityState(this.props,e.videoId,{mediaQuality:e.mediaQuality,mediaReadyState:e.readyState}),this.updatePlayerState(this.props,{mediaQuality:e.mediaQuality,mediaReadyState:e.readyState})},setMediaAPI:function(e){this.mediaAPI=e},mediaCommandsLogic:function(e,a){this.mediaAPI&&this.mediaAPI(e,a)},playMedia:function(){this.mediaCommandsLogic("play")},pauseMedia:function(){this.mediaCommandsLogic("pause")},stopMedia:function(){this.mediaCommandsLogic("stop")},createFillLayers:function(a){var t=e.assign({},this.props,a),i={skin:"skins.viewer.balata.balataBaseSkin",styleId:t.styleId+o.balataConsts.BALATA},s=t.isMobileView?"mobile":"desktop",p={ref:o.balataConsts.BALATA,id:t.id+o.balataConsts.BALATA,key:(t.isPlayingAllowed?"playback":"no-playback")+s,parentId:t.id,style:t.bgStyle||o.defaultStyle,compBehaviors:t.compStaticBehaviors,compProp:this.props.compProp,compDesign:t.compDesign,onClick:t.onClick,mediaQuality:t.mediaQuality,notifyMediaState:this.onMediaChange,setMediaAPI:this.setMediaAPI,isPlayingAllowed:t.isPlayingAllowed,enableVideo:t.isDesktopDevice&&!t.isMobileView};return this.createChildComponent(t.compData,"wysiwyg.viewer.components.background.Balata",i,p)}}}),define("mediaCommon/mediaLogic/mediaPlayerLogicMixin",["lodash","react","santaProps","utils","balata"],function(e,a,t,i,s){function p(a,t){return a.storyboardUrl?null:{storyboardUrl:e.get(t,["storyboard","url"])||""}}function o(a){return e.get(a.compDesign,["background","mediaRef"],e.get(a.compData,["background","mediaRef"]))||{}}var l=i.mediaConsts;return{propTypes:e.defaults({id:t.Types.Component.id.isRequired,styleId:t.Types.Component.styleId.isRequired,compData:t.Types.Component.compData,compProp:t.Types.Component.compProp,compDesign:t.Types.Component.compDesign,compStaticBehaviors:t.Types.Component.compStaticBehaviors,compDynamicBehaviors:t.Types.Component.compDynamicBehaviors,bgStyle:a.PropTypes.object,onClick:a.PropTypes.func,mediaAspect:t.Types.SiteAspects.mediaAspect.isRequired,mediaQuality:t.Types.Media.mediaQuality,isPlayingAllowed:t.Types.RenderFlags.isPlayingAllowed.isRequired},t.santaTypesUtils.getSantaTypesByDefinition(s)),getInitialState:function(){return this.registerPlayer(this.props),this.mediaAPI=null,{}},componentWillReceiveProps:function(e){this.handleVideoDataChange(this.props,e)},handleVideoDataChange:function(e,a){var t=o(a),i=o(e);t.videoId!==i.videoId&&(this.unregisterPlayer(e),this.registerPlayer(a))},registerPlayer:function(a){var t=o(a);if("WixVideo"===e.get(t,"type")){var i={playerType:"mediaContainer",mediaData:t,services:{fileAvailability:{callback:this.onFileAvailability,mediaQuality:a.mediaQuality}}};a.mediaAspect.registerPlayer(a.id,i)}},unregisterPlayer:function(e){e.mediaAspect.unregisterPlayer(e.id)},updatePlayerState:function(e,a){e.mediaAspect.updatePlayerState(e.id,a)},updateQualityState:function(a,t,i){var s=p(a.mediaAspect.getQualityData(t),o(a));a.mediaAspect.updateQualityState(t,e.assign(i,s))},onMediaChange:function(e){var a=this.props.mediaAspect.getData(this.props.id),t=this.mediaStateChangeLogic(e,a);this.updatePlayerState(this.props,t)},mediaStateChangeLogic:function(e,a){var t={},i=a.playbackState===l.playbackTypes.PLAYING;switch(e.type){case l.eventTypes.MOUNT:t={playbackState:e.playbackState,volume:1,fullscreen:!1,muted:!1,currentTime:0,progress:0};break;case l.eventTypes.LOAD:t={playbackState:e.playbackState,volume:e.volume,fullscreen:!1,muted:e.muted,currentTime:e.currentTime,progress:e.progress};break;case l.eventTypes.PLAYSTATE:var s=a.playbackState===l.playbackTypes.SEEK_PLAYING||a.playbackState===l.playbackTypes.SEEK_PAUSED;e.playbackState===l.playbackTypes.SEEKING?s||(t={playbackState:i?l.playbackTypes.SEEK_PLAYING:l.playbackTypes.SEEK_PAUSED}):e.playbackState===l.playbackTypes.SEEKING_ENDED?t={playbackState:a.playbackState===l.playbackTypes.SEEK_PLAYING?l.playbackTypes.PLAYING:l.playbackTypes.PAUSED}:s||(t={playbackState:e.playbackState});break;case l.eventTypes.ERROR:break;case l.eventTypes.TIME_UPDATE:t={currentTime:e.currentTime};break;case l.eventTypes.PROGRESS:t={progress:e.progress};break;case l.eventTypes.VOLUME:t={volume:e.volume,muted:e.muted}}return e.duration&&(t.duration=e.duration),t},onFileAvailability:function(e){this.updateQualityState(this.props,e.videoId,{mediaQuality:e.mediaQuality,mediaReadyState:e.readyState}),this.updatePlayerState(this.props,{mediaQuality:e.mediaQuality,mediaReadyState:e.readyState})},setMediaAPI:function(e){this.mediaAPI=e},mediaCommandsLogic:function(a){if(this.mediaAPI){var t=this.props.mediaAspect.getData(this.props.id),i=e.tail(arguments),s=t.playbackState===l.playbackTypes.PLAYING;switch(a){case"togglePlay":s?this.pauseMedia():this.playMedia();break;case"play":t.playbackState===l.playbackTypes.PLAY_ENDED&&this.updatePlayerState(this.props,{playbackState:l.playbackTypes.SEEK_PLAYING});var p=e.head(i);p>=0&&this.seekMedia(p),this.mediaAPI("play");break;case"pause":this.mediaAPI("pause");var o=e.head(i);o>=0&&this.seekMedia(o);break;case"seekStart":this.updatePlayerState(this.props,{playbackState:s?l.playbackTypes.SEEK_PLAYING:l.playbackTypes.SEEK_PAUSED}),s&&this.pauseMedia();break;case"seekEnd":var n=e.head(i);t.playbackState===l.playbackTypes.SEEK_PLAYING?this.playMedia(n):this.seekMedia(n);break;default:this.mediaAPI(a,i)}}},togglePlayMedia:function(){this.mediaCommandsLogic("togglePlay")},playMedia:function(e){this.mediaCommandsLogic("play",e)},pauseMedia:function(e){this.mediaCommandsLogic("pause",e)},stopMedia:function(){this.mediaCommandsLogic("stop")},setMediaVolume:function(e){this.mediaCommandsLogic("setVolume",e)},muteMedia:function(){this.mediaCommandsLogic("mute")},unMuteMedia:function(){this.mediaCommandsLogic("unMute")},seekMedia:function(e){this.mediaCommandsLogic("seek",e)},startSeekMedia:function(e){this.mediaCommandsLogic("seekStart",e)},endSeekMedia:function(e){this.mediaCommandsLogic("seekEnd",e)},createFillLayers:function(a){var t=e.assign({},this.props,a),i={skin:"skins.viewer.balata.balataBaseSkin",styleId:t.styleId+l.balataConsts.BALATA},s={ref:l.balataConsts.BALATA,id:t.id+l.balataConsts.BALATA,parentId:t.id,style:t.bgStyle||l.defaultStyle,compBehaviors:t.compStaticBehaviors,compProp:t.compProp,compDesign:t.compDesign,onClick:t.onClick,mediaQuality:t.mediaQuality,notifyMediaState:this.onMediaChange,setMediaAPI:this.setMediaAPI,enableVideo:!0,isPlayingAllowed:this.props.isPlayingAllowed};return this.createChildComponent(t.compData,"wysiwyg.viewer.components.background.Balata",i,s)}}}),define("mediaCommon",["lodash","coreUtils","balata","mediaCommon/mediaLogic/fillLogicMixin","mediaCommon/mediaLogic/mediaPlayerLogicMixin"],function(e,a,t,i,s){var p=a.mediaConsts;return{balata:t,defaultMediaStyle:p.defaultMediaStyle,popupMediaStyle:p.popupMediaStyle,mediaLogicMixins:{fill:i,mediaPlayer:s},mediaBehaviors:{fill:{play:{methodName:"playMedia",params:[{name:"time",defaultValue:-1}]},pause:{methodName:"pauseMedia",params:[{name:"time",defaultValue:-1}]},stop:{methodName:"stopMedia"}},mediaPlayer:{togglePlay:{methodName:"togglePlayMedia"},play:{methodName:"playMedia",params:[{name:"time",defaultValue:-1}]},pause:{methodName:"pauseMedia",params:[{name:"time",defaultValue:-1}]},stop:{methodName:"stopMedia"},setVolume:{methodName:"setMediaVolume",params:["volume"]},mute:{methodName:"muteMedia"},unMute:{methodName:"unMuteMedia"},seek:{methodName:"seekMedia",params:["time"]},seekStart:{methodName:"startSeekMedia"},seekEnd:{methodName:"endSeekMedia",params:["time"]},enterFullScreen:{methodName:"enterFullscreen"},exitFullScreen:{methodName:"exitFullscreen"}}}}});
//# sourceMappingURL=mediaCommon.min.js.map