"use strict";define("siteBackground",["lodash","santaProps","core","utils","mediaCommon","backgroundCommon"],function(e,i,t,r,o,s){function a(i,t){var r=e.get(i,"scrollType"),o=e.get(i,["mediaRef","type"]),s="Image"===o||"WixVideo"===o;return t.fixedSiteBackground&&!t.isMobileView&&s||(r="scroll"),r}function n(e,i){var t=i;return e.isMobileView||e.isAndroidOldBrowser?t="scroll":e.fixedSiteBackground||(t=""),t}function c(i,t,r){var o="absolute",s=e.get(t,["mediaRef","type"]);return i.isMobileDevice||"WixVideo"!==s&&"fixed"!==r&&"parallax"!==r||(o="fixed"),o}function p(e,i,t){var o=n(e,a(i,e)),s=c(e,i,o);return{top:0,height:"100%",width:"100%",backgroundColor:r.colorParser.getColor(e.colorsMap,i.color),display:t?"none":"",position:s}}function l(e){var i="100%";return"parallax"===e&&(i="120%"),i}function u(e){var i=0;return"parallax"===e&&(i=0),i}function d(e,i){var t=i.mediaRef;return{position:"absolute",top:u(a(i,e)),height:l(a(i,e)),width:"100%",opacity:t&&t.opacity}}function g(){return[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]}function h(i,t){var r=i.mediaRef||{},o=t.mediaRef||{},s=!i.mediaRef&&!t.mediaRef,a=s||r.type===o.type,n="WixVideo"===r.type&&a,c=["mediaRef","imageOverlay"],p=["type","alignType","fittingType","scrollType","colorOverlay","colorOverlayOpacity","color","videoId","uri","opacity"];return n?p=e.without(p,"color"):s&&(p=["color"]),a&&v(i,t,c,p)}function v(i,t,r,o){var s=e.every(o,function(e){return(i&&i[e])===(t&&t[e])});return s=s&&e.every(r,function(e){return!i||v(i[e],t[e],r,o)})}function m(e,i){var t=i.colorOverlay?r.colorParser.getColor(e.colorsMap,i.colorOverlay,i.colorOverlayOpacity):null;return{position:"absolute",top:0,width:"100%",height:"100%",backgroundImage:y(e,i.imageOverlay),backgroundColor:t}}function y(e,i){return i?"url("+r.urlUtils.joinURL(e.staticMediaUrl,i.uri)+")":null}var f=r.mediaConsts;return{displayName:"SiteBackground",mixins:[o.mediaLogicMixins.fill,t.compMixins.skinBasedComp,t.compMixins.animationsMixin,s.mixins.backgroundDetectionMixin],propTypes:e.defaults({id:i.Types.Component.id,compData:i.Types.Media.SiteBackground.data,actionsAspect:i.Types.SiteAspects.actionsAspect.isRequired,currentUrlPageId:i.Types.Component.currentUrlPageId,isMobileView:i.Types.isMobileView.isRequired,isTouchDevice:i.Types.Device.isTouchDevice,isAndroidOldBrowser:i.Types.Browser.isAndroidOldBrowser,colorsMap:i.Types.Theme.colorsMap,staticMediaUrl:i.Types.ServiceTopology.staticMediaUrl,componentViewMode:i.Types.RenderFlags.componentViewMode.isRequired,fixedSiteBackground:i.Types.BrowserFlags.fixedSiteBackground.isRequired,mediaQuality:i.Types.Media.SiteBackground.mediaQuality},i.santaTypesUtils.getSantaTypesByDefinition(s.components.html5Video)),statics:{useSantaTypes:!0,behaviors:o.mediaBehaviors.fill},previousScroll:null,getInitialState:function(){return this.size={},{resetAttachment:!1,hidePrevious:!1}},callForBackgroundChange:function(i){var t={onComplete:function(){this.isPageChanged()&&(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,resetAttachment:!1,hidePrevious:!0}))}.bind(this)};this.props.actionsAspect.registerNextBGPageTransition(this,"previous","current",t),this.setState({previousPageBackground:i,resetAttachment:!0,hidePrevious:!1,currentVisiblePageId:null})},componentWillReceiveProps:function(i){if(this.isPageChanged()){var t=this.props.compData.background;h(i.compData.background,t)?(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,currentVisiblePageId:this.state.currentVisiblePageId||this.props.compData.background.id})):this.callForBackgroundChange(t)}},handleParallaxBehavior:function(e){var i=a(e,this.props);("parallax"===this.previousScroll||"parallax"===i)&&(this.previousScroll=i,"parallax"===i?this.props.actionsAspect.registerBehaviors("currentImage","siteBackground",g()):this.props.actionsAspect.unRegisterBehaviors("currentImage",g()))},getClasses:function(){return""},isPageChanged:function(){return this.props.compData.background.id!==e.get(this.state,["previousPageBackground","id"])},createVideoComponent:function(i,t){var r={comp:"wysiwyg.viewer.components.background.html5Video",skin:"skins.viewer.bgVideo.html5VideoSkin",style:"bgVideo"},o=i.mediaRef,s="current"===t;return"WixVideo"!==e.get(o,"type")?(s&&this.setMediaAPI(null),null):this.createChildComponent(o,r.comp,{skin:r.skin,styleId:r.style},{id:this.props.id+t+"Video",notifyMediaState:this.onMediaChange,setMediaAPI:s?this.setMediaAPI:e.noop,mediaQuality:this.props.mediaQuality,className:"siteBackground"+t+"Video",compProp:e.pick(o,f.playback.SUPPORTED_MEDIA_ATTRIBUTES)})},getSkinProperties:function(){var i=this.state.currentVisiblePageId||this.props.compData.background.id,t=e.get(this.state.previousPageBackground,"id","noPrev");t=t===i?"noPrev":t;var r,o,s,n,c=null,l=!this.props.isTouchDevice,u=this.props.id,g=this.props.compData.background;return n={id:u+"_currentImage_"+i,style:d(this.props,g),"data-type":f.balataConsts.BG_IMAGE},l&&((o=this.createVideoComponent(g,"current"))||this.setMediaAPI(null)),this.state.previousPageBackground&&(c=this.state.previousPageBackground,s={id:u+"_previousImage_"+t,style:c?d(this.props,c):{}},l&&(r=this.createVideoComponent(c,"previous"))),this.handleParallaxBehavior(g),{"":{id:u,className:this.getClasses()},current:{key:i+a(g,this.props)+this.props.componentViewMode,id:u+"_current_"+i,style:p(this.props,g,!1)},currentImage:n,currentVideo:o,currentOverlay:{id:u+"_currentOverlay_"+i,style:m(this.props,g)},previous:{key:t+a(c,this.props)+this.props.componentViewMode,id:u+"_previous_"+t,style:c?p(this.props,c,this.state.hidePrevious):{}},previousImage:s,previousVideo:r,previousOverlay:{id:u+"_previousOverlay_"+t,style:c?m(this.props,c):{}}}}}});
//# sourceMappingURL=siteBackground.min.js.map